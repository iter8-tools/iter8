apiVersion: iter8.tools/v2alpha2
kind: Experiment
metadata:
  name: quickstart-exp
spec:
  target: flowers
  strategy:
    testingPattern: A/B
    deploymentPattern: Progressive
    # actions:
    #   finish: # run the following sequence of tasks at the end of the experiment
    #   - task: common/exec # promote the winning version
    #     with:
    #       cmd: kubectl
    #       args: 
    #       - "apply"
    #       - "-f"
    #       - "https://raw.githubusercontent.com/iter8-tools/iter8/master/samples/knative/quickstart/{{ .promote }}.yaml"
  criteria:
    requestCount: iter8-kfserving/request-count
    rewards: # Business rewards
    - metric: iter8-kfserving/user-engagement
      preferredDirection: High # maximize user engagement
    objectives: 
    - metric: iter8-kfserving/mean-latency
      upperLimit: 500
    - metric: iter8-kfserving/95th-percentile-tail-latency
      upperLimit: 1000
    - metric: iter8-kfserving/error-rate
      upperLimit: "0.01"
  duration:
    intervalSeconds: 10
    iterationsPerLoop: 10
  versionInfo:
    # information about app versions used in this experiment
    baseline:
      name: current
      variables:
      - name: version
        value: flowers-v1 
      # - name: promote
      #   value: baseline
    candidates:
    - name: candidate
      variables:
      - name: version
        value: flowers-v2
      # - name: promote
      #   value: candidate 
