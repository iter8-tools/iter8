<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Title -->
  <title>iter8 Documentation</title>

  <!-- Required Meta Tags Always Come First -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Favicon -->
  <link rel="shortcut icon" href="../../../favicon.png">

  <!--  Meta tags -->
  <meta name="keywords"
    content="Iter8, A/B testing, microservices, Kubernetes, software, cloud, analytics, canary release">
  <meta name="description"
    content="Iter8 supports cloud-native, automated canary releases and A/B testing of microservices on Kubernetes. Under the hood, iter8 uses robust statistical algorithms to determine the best version of your service, progressively shift traffic towards this version, and eventually rollout this version, where the notion of best is determined by the criteria you specify in your iter8 experiment.">

  <!-- Schema.org -->
  <meta itemprop="name" content="Deliver Better Software with Iter8">
  <meta itemprop="description"
    content="Iter8 supports cloud-native, automated canary releases and A/B testing of microservices on Kubernetes. Under the hood, iter8 uses robust statistical algorithms to determine the best version of your service, progressively shift traffic towards this version, and eventually rollout this version, where the notion of best is determined by the criteria you specify in your iter8 experiment.">
  <meta itemprop="image" content="../../img-temp/iter8-promo-resized-open-graph.png">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="product">
  <meta name="twitter:site" content="@Iter8_app">
  <meta name="twitter:title" content="Deliver Better Software with Iter8">
  <meta name="twitter:description"
    content="Iter8 supports cloud-native, automated canary releases and A/B testing of microservices on Kubernetes. Under the hood, iter8 uses robust statistical algorithms to determine the best version of your service, progressively shift traffic towards this version, and eventually rollout this version, where the notion of best is determined by the criteria you specify in your iter8 experiment.">
  <meta name="twitter:creator" content="@Iter8_app">
  <meta name="twitter:image" content="../../img-temp/iter8-promo-resized-open-graph.png">

  <!-- Open Graph -->
  <meta property="og:title" content="Deliver Better Software with Iter8">
  <meta property="og:type" content="article">
  <meta property="og:url" content="https://iter8.tools/">
  <meta property="og:image" content="../../img-temp/iter8-promo-resized-open-graph.png">
  <meta property="og:description"
    content="Iter8 supports cloud-native, automated canary releases and A/B testing of microservices on Kubernetes. Under the hood, iter8 uses robust statistical algorithms to determine the best version of your service, progressively shift traffic towards this version, and eventually rollout this version, where the notion of best is determined by the criteria you specify in your iter8 experiment.">
  <meta property="og:site_name" content="iter8 Documentation">

  <!-- Google Fonts -->
  <link href="//fonts.googleapis.com/css?family=Poppins:300,400,500,600" rel="stylesheet">

  <!-- CSS Implementing Plugins -->
  <link rel="stylesheet" href="../../vendor/font-awesome/css/fontawesome-all.min.css">
  <link rel="stylesheet" href="../../vendor/malihu-custom-scrollbar-plugin/jquery.mCustomScrollbar.css">
  <link rel="stylesheet" href="../../vendor/jquery-ui/themes/base/jquery-ui.min.css">
  <link rel="stylesheet" href="../../vendor/prism/prism.css">

  <!-- CSS Template -->
  <link rel="stylesheet" href="../../css/theme.css">
  <link rel="stylesheet" href="../../css/layout.css">
  <link rel="stylesheet" href="../../css/demo.css">
</head>

<body class="bg-white">
  <!-- Header -->
  <header class="duik-header">
    <nav class="navbar navbar-expand-md fixed-top bg-white border-bottom text-dark py-2">
      <a class="link-dark mr-lg-7 mr-0 mr-md-5" href="../../../index.html.html" target="_self">
        <a class="navbar-brand" href="../../../index.html"><img src="../../img/logo-dark-cropped.png" alt="Iter8"
            style="width: 150px;"></a>
        <span class="ml-3">
          <a href="../more/releases.html"><span class="badge badge-pill badge-dark px-2">v0.2.1</span></a>
        </span>
      </a>
    </nav>
  </header>
  <!-- End Header -->

  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar -->
      <nav class="col-md-3 col-lg-2 duik-sidebar border-md-right navbar-expand-md">
        <div class="d-flex justify-content-between mb-3">
          <!-- Sidebar Search -->
          <form class="col form-inline input-group-sm pt-2">
            <input class="js-search form-control form-control-sm w-100" type="text" placeholder="Search..."
              data-url="../../include/json/autocomplete-data-for-documentation-search.json">
          </form>
          <!-- End Sidebar Search -->

          <!-- Responsive Toggle Button -->
          <button class="btn btn-link pl-0 d-md-none" type="button" data-toggle="collapse" data-target="#sidebar-nav"
            aria-controls="sidebar-nav" aria-expanded="false" aria-label="Toggle navigation">
            <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 30 30" width="30" height="30" focusable="false">
              <path stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-miterlimit="10"
                d="M4 7h22M4 15h22M4 23h22" />
            </svg>
          </button>
          <!-- End Responsive Toggle Button -->
        </div>

        <!-- Sidebar Nav -->
        <div class="collapse navbar-collapse border-bottom border-md-0" id="sidebar-nav">
          <div class="js-scrollbar duik-sidebar-sticky">
            <h5 class="duik-sidebar__heading">Introduction</h5>
            <ul class="duik-sidebar__nav">
              <li class="duik-sidebar__item"><a class="duik-sidebar__link" href="../introduction/about.html">About</a></li>
              <li class="duik-sidebar__item"><a class="duik-sidebar__link" href="../introduction/install.html">Installation</a></li>
              <li class="duik-sidebar__item"><a class="duik-sidebar__link" href="../introduction/experiment.html">Experiment</a></li>
              <li class="duik-sidebar__item"><a class="duik-sidebar__link active" href="../introduction/metrics.html">Metrics</a></li>
            </ul>

            <h5 class="duik-sidebar__heading">Tutorials</h5>
            <ul class="duik-sidebar__nav">
              <li class="duik-sidebar__item"><a class="duik-sidebar__link" href="../tutorials/tutorial-deployments.html">Canary with deployments</a></li>
              <li class="duik-sidebar__item"><a class="duik-sidebar__link" href="../tutorials/tutorial-services.html">Canary with services</a></li>
            </ul>

            <h5 class="duik-sidebar__heading">Integrations</h5>
            <ul class="duik-sidebar__nav">
              <li class="duik-sidebar__item"><a class="duik-sidebar__link" href="../integrations/grafana.html">Grafana</a></li>
              <li class="duik-sidebar__item"><a class="duik-sidebar__link" href="../integrations/kiali.html">Kiali</a></li>
              <li class="duik-sidebar__item"><a class="duik-sidebar__link" href="../integrations/iter8-trend.html">iter8-trend</a></li>
              <li class="duik-sidebar__item"><a class="duik-sidebar__link" href="../integrations/iter8-kui.html">iter8-KUI</a></li>
            </ul>

            <h5 class="duik-sidebar__heading">More</h5>
            <ul class="duik-sidebar__nav">
              <li class="duik-sidebar__item"><a class="duik-sidebar__link" href="../more/algorithm.html">Algorithms</a></li>
              <li class="duik-sidebar__item"><a class="duik-sidebar__link" href="../more/blogs.html">Blogs</a></li>
              <li class="duik-sidebar__item"><a class="duik-sidebar__link" href="../more/releases.html">Releases</a></li>
            </ul>
          </div>
        </div>
        <!-- End Sidebar Nav -->
      </nav>
      <!-- End Sidebar -->

      <main class="ml-sm-auto col-md-9 col-lg-10 px-4 pr-10 pt-0 pt-md-11">
        <!-- Content -->
        <div class="col-xl-12 order-xl-1 duik-content border-bottom">

          <!-- Metrics -->
          <div id="metrics" class="mb-7">
            <h2>Metrics<a class="js-anchor-link duik-anchorjs-link" href="#metrics" aria-label="Anchor"
                data-anchorjs-icon="#"></a></h2>

            <!-- Introduction -->
            <div id="introduction">
              <p>This section describes iter8's out-of-the-box metrics, the anatomy of a metric definition, and how
                users can define their own metrics</p>
            </div>
            <!-- End introduction -->

            <!-- Iter8 metrics -->
            <div id="iter8-metrics" class="mb-7">
              <h5>Metrics defined by iter8<a class="js-anchor-link duik-anchorjs-link" href="#iter8-metrics"
                  aria-label="Anchor" data-anchorjs-icon="#"></a></h5>

              <p>
                By default, iter8 leverages the metrics collected by Istio telemetry and stored in Prometheus. Users
                relying on iter8's out-of-the-box metrics can simply reference them in the success criteria of an
                experiment specification, as shown in the <a
                  href="../introduction/experiment.html">Experiment CRD documentation</a>.
                </p>

              <p>
                During an experiment, for every call made from <code>iter8-controller</code> to
                <code>iter8-analytics</code>, the latter in turn calls Prometheus to retrieve values of the metrics
                referenced by the Kubernetes <code>experiment</code> resource. <code>iter8-analytics</code> analyzes the
                service versions that are part of the experiment and arrives at an assessment based on their metric
                values. It returns this assessment to <code>iter8-controller</code>.
              </p>

              <p>
                In particular, the following metrics are available out-of-the-box from iter8. These metrics are based
                on the telemetry data collected by Istio.
              </p>

              <ol>
                <li>
                  <code>iter8_latency</code>: mean latency, that is, average time taken by the service version to
                  respond
                  to HTTP requests.
                </li>
                <li>
                  <code>iter8_error_count</code>: total error count, that is, number of HTTP requests that resulted in
                  error (<code>5XX</code> HTTP status codes).
                </li>
                <li>
                  <code>iter8_error_rate</code>: error rate, that is, (total error count / total number of HTTP
                  requests).
                </li>
              </ol>

              <!-- NOTE: link points to external -->

              <p>
                When iter8 is installed, a Kubernetes <code>ConfigMap</code> named <code>iter8config-metrics</code> is
                populated with a definition for each of the above metrics. You can see the metric definitions in this
                <a
                  href="https://raw.githubusercontent.com/iter8-tools/iter8-controller/v0.2.1/install/helm/iter8-controller/templates/metrics/iter8_metrics.yaml">file</a>.
                A few things to note in the definitions:
              </p>

              <ul>
                <li>
                  Each metric is defined under the <code>metrics</code> section.
                </li>
                <li>
                  They refer back to a Prometheus query template defined under the <code>query_templates</code> section.
                  Iter8 uses that template to query Prometheus and compute the value of the metric for every service
                  version.
                </li>
                <li>
                  If this metric is a counter (i.e., its value never decreases over time), then the
                  <code>is_counter</code> key corresponding to this metric is set to <code>True</code>; otherwise, it is
                  set to <code>False</code>.
                </li>
                <li>
                  If the value of a metric is unavailable (for example, Prometheus returned <code>NaN</code> or a
                  <code>null</code> for the query corresponding to his metric), then, by default, iter8 sets the value of
                  this metric to <code>0</code>. This can be changed to any other float value (specified by the user in
                  string format, e.g., <code>"22.8"</code>) or to <code>"None"</code> using the
                  <code>absent_value</code>
                  key.
                </li>
                <li>
                  Finally, each metric is associated with another key <code>sample_size_query_template</code> whose
                  value is a Prometheus query template. Iter8 relies on the notion of a sample-size to compute the total
                  number of data points used in the computation of the metric values. Each of the iter8-defined metrics is
                  associated with the <code>iter8_sample_size</code> query template defined under
                  <code>query_templates</code>, which computes the total number of requests received by a service
                  version.
                  For the default iter8 metrics (mean latency, error count, and error rate), the total number of
                  requests is the correct sample size measure.
                </li>
              </ul>
            </div>
            <!-- End iter8 metrics -->

            <!-- Add metric -->
            <div id="add-metrics" class="mb-7">
              <h5>Adding a new metric<a class="js-anchor-link duik-anchorjs-link" href="#add-metrics"
                  aria-label="Anchor" data-anchorjs-icon="#"></a></h5>
              <p>
                Next, we describe how iter8 can be extended with new metrics through the <code>iter8-metrics</code>
                <code>ConfigMap</code>. Any metric you define in the <code>ConfigMap</code> can then be referenced in
                the success criteria of experiments.
              </p>

              <p>
                As an example, we will define a new metric called <code>error_count_400s</code> which computes the total
                count of HTTP requests that resulted in a <code>400</code> HTTP status code. Adding a new metric involves creating a
                Prometheus query template and associating this template with the metric definition. We now describe the
                structure of a Prometheus query template.
              </p>

              <!-- Prometheus query template -->
              <div id="prometheus-template" class="mb-7">
                <h6>Prometheus query template<a class="js-anchor-link duik-anchorjs-link" href="#prometheus-template"
                    aria-label="Anchor" data-anchorjs-icon="#"></a></h6>

                <p>A sample query template is shown below:</p>

                <pre class="language-shell">
sum(increase(istio_requests_total{response_code=~'4..',reporter='source'}[$interval]$offset_str)) by ($entity_labels)</pre>

                <p>
                  As shown above, the query template has three placeholders (i.e., terms beginning with <code>$</code>). These
                  placeholders are substituted with actual values by <code>iter8-analytics</code> in order to construct
                  a Prometheus query.
                </p>

                <ol>
                  <li>
                    The query template has a <code>group by</code> clause (specified using the
                    <code>by</code> keyword) with the placeholder <code>$entity_labels</code> as the group key. Each group
                    in a Prometheus response corresponds to a distinct entity. <code>Iter8-analytics</code> maps service
                    versions to Prometheus entities using this placeholder.
                  </li>
                  <li>
                    The time period of aggregation is captured by the placeholder <code>$interval</code>.
                  </li>
                  <li>
                    The placeholder <code>$offset_str</code> is used by <code>iter8-analytics</code> to deal with historical data when available. 
                  </li>
                </ol>

                <p>
                  All three placeholders are
                  required in the query template. When a template is instantiated (i.e., placeholders are substituted
                  with values), it results in a Prometheus query expression; when we query Prometheus using this expression,
                  the response from Prometheus needs to be an <a href="https://prometheus.io/docs/prometheus/latest/querying/basics/">instant vector</a>.
                </p>
              </div>
              <!-- End Prometheus query template -->

              <!-- Update iter8-metrics ConfigMap -->
              <div id="update-configmap" class="mb-7">
                <h6>Updating the <code>iter8-metrics</code> <code>ConfigMap</code><a class="js-anchor-link duik-anchorjs-link"
                    href="#update-configmap" aria-label="Anchor" data-anchorjs-icon="#"></a></h6>

                <p>There are two steps involved in adding a new metric.</p>

                <p>Step 1: Extend the <code>query_templates</code> section of the <code>ConfigMap</code>.</p>

                <pre class="language-shell">
error_count_400s: "sum(increase(istio_requests_total{job='istio-mesh',response_code=~'4..',reporter='source'}[$interval]$offset_str)) by ($entity_labels)"</pre>

                <p>
                  For example, we have added our sample query template under a new key called
                  <code>error_count_400s</code>
                  in the <code>query_templates</code> section of the <code>ConfigMap</code>.
                </p>

                <p>
                  Step 2: We define a new metric in the <code>metrics</code> section of the <code>ConfigMap</code> as follows:
                </p>

                <pre class="language-shell">
- name: error_count_400s
  is_counter: True
  sample_size_query_template: iter8_sample_size</pre>

                <p>
                  The interpretation of the above definition is as follows.
                </p>

                <ul>
                  <li>
                    <code>name</code>: Name of the new metric being defined. Its value is the key for the associated
                    query
                    template. In our example, the relevant key is <code>error_count_400s</code>.
                  </li>

                  <li>
                    <code>is_counter</code>: Set this to <code>True</code> if this metric is a counter metric. In our
                    example, <code>4XX</code> errors can never decrease over time, and therefore <code>is_counter</code> is set to
                    <code>True</code>.
                  </li>

                  <li>
                    <code>sample_size_query_template</code>: As explained earlier, this is the sample size query template associated
                    with this metric. The sample over which this value is computed for a version is the set of all HTTP
                    requests received by the version. Hence, we are relying on the pre-defined sample-size query template
                    <code>iter8_sample_size</code>, which computes the total number of HTTP requests for a version. If
                    you are defining a metric that requires the sample size to be computed differently, you can create a new
                    sample-size query template (with its own unique name) in the <code>query_templates</code> section
                    and reference it in the metric declaration.
                  </li>
                </ul>
              </div>
              <!-- End update iter8-metrics ConfigMap -->
            </div>
            <!-- End add metric -->
          </div>
          <!-- End metrics -->
        </div>      </main>
    </div>
  </div>

  <!-- Go to Top -->
  <a class="js-go-to duik-go-to" href="javascript:;">
    <span class="fa fa-arrow-up duik-go-to__inner"></span>
  </a>
  <!-- End Go to Top -->

  <!-- JS Global Compulsory -->
  <script src="../../vendor/jquery/dist/jquery.min.js"></script>
  <script src="../../vendor/jquery-migrate/dist/jquery-migrate.min.js"></script>
  <script src="../../vendor/popper.js/dist/umd/popper.min.js"></script>
  <script src="../../vendor/bootstrap/dist/js/bootstrap.min.js"></script>

  <!-- JS Implementing Plugins -->
  <script src="../../vendor/malihu-custom-scrollbar-plugin/jquery.mCustomScrollbar.concat.min.js"></script>
  <script src="../../vendor/jquery-ui/jquery-ui.core.min.js"></script>
  <script src="../../vendor/jquery-ui/ui/widgets/menu.js"></script>
  <script src="../../vendor/jquery-ui/ui/widgets/mouse.js"></script>
  <script src="../../vendor/jquery-ui/ui/widgets/autocomplete.js"></script>
  <script src="../../vendor/prism/prism.js"></script>

  <!-- JS -->
  <script src="../../js/main.js"></script>
  <script src="../../js/autocomplete.js"></script>
  <script src="../../js/custom-scrollbar.js"></script>
</body>

</html>